name: "jenkine bridge"
description: "trigger jenkine pipeline"
inputs:
  token: # id of input
    description: "api auth token"
    required: true
    default: ""
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v2

    - name: Print Env
      shell: bash
      run: |
        # Print Env
        echo ::group::Environment
        export
        echo ::endgroup::

    - name: Install Client
      shell: bash
      run: |
        # Install Client
        echo ::group::Install Client Log
        sudo wget --quiet https://repo.peeweep.de/tmp/jenkins-bridge-client -O /usr/bin/jenkins-bridge-client
        sudo chmod +x -v /usr/bin/jenkins-bridge-client
        echo ::endgroup::

    - name: Job
      shell: bash
      env:
        BRIDGE_TOKEN: ${{ inputs.token }}
      run: |
        # Job
        echo ::group::Job log
        jenkins-bridge-client -token "$BRIDGE_TOKEN" -printlog 1
        echo ""
        echo ::endgroup::

    - name: Download Artifacts
      shell: bash
      env:
        BRIDGE_TOKEN: ${{ inputs.token }}
      run: |
        # Download Artifacts
        echo ::group::Download Artifacts Log
        jenkins-bridge-client -token "$BRIDGE_TOKEN" -downloadArtifacts 1
        ls -lh ./artifacts
        echo ::endgroup::

    - uses: peeweep-test/upload-artifact@single-artifact-upload
      with:
        path: ./artifacts/*.deb
        single-archive: "false"
