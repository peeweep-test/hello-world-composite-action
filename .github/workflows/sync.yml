name: Sync
on:
  push:
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 2

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v13.1

      - name: List all changed files
        run: |
          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            echo "$file was changed"
          done
      - name: sync all changed files
        run: |
          repo=repos/peeweep-test/test-action
          for file in $(cat $repo); do
              repo=${repo#"repos"}
              echo sync $file to $repo/$line
              content=`cat $file | base64`
              echo curl -X PUT \
                  -H "Accept: application/vnd.github.v3+json" \
                  -H 'Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
                  "https://api.github.com/repos/peeweep-test/test-action/contents/$line" \
                  -d '{"message":"message","content":"'$content'"}'
          done
